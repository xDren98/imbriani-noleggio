<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imbriani Stefano Noleggio - Sistema Prenotazioni</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles-fixed.css">
</head>
<body>
    <div class="container mt-4">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="display-4">üöê Imbriani Stefano Noleggio</h1>
            <p class="lead text-muted">Sistema di prenotazione pulmini (‚â•9 posti)</p>
        </div>
        
        <!-- Login Section -->
        <div id="login-section" class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">üîë Accesso Cliente</h5>
                <p class="text-muted">Inserisci il tuo Codice Fiscale per accedere all'area personale</p>
                <div class="row g-3">
                    <div class="col-md-8">
                        <input 
                            type="text" 
                            id="cf-input" 
                            class="form-control" 
                            placeholder="Codice Fiscale (16 caratteri)" 
                            maxlength="16"
                            style="text-transform: uppercase;"
                        >
                        <div class="form-text">Formato: RSSMRA85M01H501Z</div>
                    </div>
                    <div class="col-md-4">
                        <button id="login-btn" class="btn btn-primary w-100">
                            <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                            Accedi
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Area Personale -->
        <div id="area-personale" class="d-none">
            <!-- Welcome Message -->
            <div class="alert alert-success border-left-success" role="alert">
                <h6 class="alert-heading">‚úÖ Accesso effettuato con successo!</h6>
                <p class="mb-0">Benvenuto nel tuo pannello personale. Qui puoi visualizzare le tue prenotazioni e crearne di nuove.</p>
            </div>

            <!-- Prenotazioni Esistenti -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="card-title">üìã Le tue prenotazioni</h5>
                    <div id="lista-prenotazioni" class="list-group">
                        <div class="text-center text-muted py-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <p class="mt-2 mb-0">Caricamento prenotazioni...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nuova Prenotazione -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="card-title">‚ûï Nuova Prenotazione</h5>
                    <p class="text-muted">Compila tutti i campi per richiedere una nuova prenotazione</p>
                    
                    <!-- Date e Orari -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="form-label fw-bold">üìÖ Data Ritiro *</label>
                            <input type="date" id="data-ritiro" class="form-control" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">üï∞ Ora Ritiro *</label>
                            <input type="time" id="ora-ritiro" class="form-control" value="08:00" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">üìÖ Data Consegna *</label>
                            <input type="date" id="data-consegna" class="form-control" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">üï∞ Ora Consegna *</label>
                            <input type="time" id="ora-consegna" class="form-control" value="20:00" required>
                        </div>
                    </div>
                    
                    <!-- Destinazione -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">üìç Destinazione *</label>
                            <input 
                                type="text" 
                                id="destinazione" 
                                class="form-control" 
                                placeholder="Es: Roma Centro, Aeroporto Fiumicino, etc."
                                required
                            >
                        </div>
                    </div>

                    <!-- Selezione Veicoli -->
                    <div class="mb-4">
                        <h6 class="fw-bold">üöê Scegli Veicolo (‚â•9 posti) *</h6>
                        <p class="text-muted small">Clicca su un veicolo per selezionarlo</p>
                        <div id="lista-veicoli" class="row g-2">
                            <div class="col-12 text-center text-muted py-3">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                <p class="mt-2 mb-0">Caricamento veicoli disponibili...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Gestione Autisti -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold mb-0">üë• Autisti (Max 3) *</h6>
                            <button id="add-driver" class="btn btn-sm btn-outline-primary">
                                <span>+ Aggiungi Autista</span>
                            </button>
                        </div>
                        <p class="text-muted small">Inserisci i dati di tutti gli autisti che guideranno il veicolo</p>
                        <div id="drivers-container"></div>
                    </div>

                    <!-- Riepilogo Prenotazione -->
                    <div class="alert alert-info border-left-primary mb-4">
                        <h6 class="alert-heading">üìã Riepilogo Prenotazione</h6>
                        <div id="riepilogo" class="mt-2">
                            <em class="text-muted">Compila i campi sopra per vedere il riepilogo</em>
                        </div>
                    </div>

                    <!-- Pulsante Conferma -->
                    <div class="text-center">
                        <button id="conferma" class="btn btn-success btn-lg px-5">
                            <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                            üì® Invia Prenotazione
                        </button>
                        <div class="form-text mt-2">Ti contatteremo presto per confermare la prenotazione</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner Overlay -->
    <div id="spinner" class="d-none spinner-overlay">
        <div class="text-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
            <div class="mt-3 text-white">
                <strong>Caricamento in corso...</strong>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (compatibilit√† shared-utils) -->
    <div id="loading-overlay" class="hidden">
        <div class="text-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
            <div class="mt-3">
                <strong>Caricamento...</strong>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Configuration -->
    <script>
    // Global Configuration
    const APP_CONFIG = {
        AUTH_TOKEN: 'imbriani_secret_2025',
        VERSION: '5.4.1-FIXED'
    };
    
    const FRONTEND_CONFIG = {
        API_URL: 'https://script.google.com/macros/s/AKfycbx8vOsfdliS4e5odoRMkvCwaWY7SowSkgtW0zTuvqDIu4R99sUEixlLSW7Y9MyvNWk/exec',
        TOKEN: 'imbriani_secret_2025'
    };
    
    const STATE_LABELS = {
        'Da confermare': { emoji: '‚è≥', color: '#f59e0b', label: 'Da confermare' },
        'Confermata': { emoji: '‚úÖ', color: '#22c55e', label: 'Confermata' },
        'Annullata': { emoji: '‚ùå', color: '#ef4444', label: 'Annullata' }
    };
    
    const Logger = { 
        error: console.error,
        warn: console.warn,
        info: console.info
    };
    
    console.log('üöÄ Imbriani Noleggio v5.4.1-FIXED caricato');
    </script>
    
    <!-- Load Scripts -->
    <script src="shared-utils.js"></script>
    <script src="scripts-fixed.js"></script>
    
    <!-- Bootstrap JS (optional, for enhanced components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>